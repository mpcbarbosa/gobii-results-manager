/**
 * Parse auto-generated task metadata from notes.
 *
 * Sprint 7 format:
 * ```
 * ---
 * autoGenerated: true
 * meta.category: RFP
 * meta.confidence: HIGH
 * meta.engineVersion: 1.0
 * ```
 *
 * @module lib/crm/parseTaskMeta
 */

export interface TaskMeta {
  autoGenerated: boolean;
  category: string | null;
  confidence: string | null;
  engineVersion: string | null;
}

export function parseTaskMeta(notes: string | null): TaskMeta {
  const meta: TaskMeta = {
    autoGenerated: false,
    category: null,
    confidence: null,
    engineVersion: null,
  };

  if (!notes) return meta;

  if (notes.includes("autoGenerated: true")) {
    meta.autoGenerated = true;
  }

  const catMatch = notes.match(/meta\.category:\s*(\S+)/);
  if (catMatch) meta.category = catMatch[1];

  const confMatch = notes.match(/meta\.confidence:\s*(\S+)/);
  if (confMatch) meta.confidence = confMatch[1];

  const verMatch = notes.match(/meta\.engineVersion:\s*(\S+)/);
  if (verMatch) meta.engineVersion = verMatch[1];

  return meta;
}
